<!-- templates/redirect.html -->
<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redirecting…</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <main class="container">
    <section class="card">
      <h2>आप अगले पेज पर जा रहे हैं</h2>
      <p class="muted small">यह intermediate SafeLink पेज — कुछ सेकंड में आप गंतव्य पर भेज दिए जाएंगे।</p>

      <div class="counter">
        <p>Redirecting to:</p>
        <p class="target"><a id="targetLink" href="{{ target }}" target="_blank">{{ target }}</a></p>
        <p>Automatic redirect in <span id="sec">{{ countdown }}</span> seconds</p>
        <button id="continue">Continue now</button>
      </div>

      <div class="ad">
        <!-- Place your ad / message / offer / policy here -->
        <p><strong>Sponsored / Notice:</strong> यहाँ अपनी ad या important notice दिखाएँ।</p>
      </div>
    </section>
  </main>

  <script>
    const slug = "{{ slug }}";
    const countdownEl = document.getElementById("sec");
    const continueBtn = document.getElementById("continue");
    let sec = parseInt("{{ countdown }}", 10) || 5;

    async function doRedirect() {
      try {
        const res = await fetch("/go/" + slug, { method: "POST" });
        const j = await res.json();
        if (res.ok && j.redirect) {
          // use location.assign so it's recorded in history
          window.location.assign(j.redirect);
        } else {
          alert("Unable to redirect: " + (j.error || "server error"));
        }
      } catch (e) {
        alert("Network error");
      }
    }

    continueBtn.addEventListener("click", doRedirect);

    const timer = setInterval(() => {
      sec -= 1;
      countdownEl.textContent = sec;
      if (sec <= 0) {
        clearInterval(timer);
        doRedirect();
      }
    }, 1000);
  </script>
</body>
</html>
